#!/usr/bin/bash

source platform

login_to_bitwarden () {
  BW_SESSION="$(./bw login --raw)"
}

find_config_in_vault () {
  BW_CONFIG=$(./bw list items --search "server-config" --collectionid 'null' --session $BW_SESSION)
}

parse_config_item () {
  echo $BW_CONFIG | python3 -c "import sys, json; print(json.load(sys.stdin)[0]${1})"
}

parse_config_item_custom_field () {
  echo $BW_CONFIG | python3 -c "import sys, json; print(next(cf for cf in json.load(sys.stdin)[0]['fields'] if cf['name'] == '${1}')['value'])"
}

save_secrets () {
  ./bw get attachment github --itemid ac755655-4d35-44bf-9bfc-b0ce013407c6 --session $BW_SESSION
  sudo mv github $HOME/.ssh 
}

install-bitwarden
login_to_bitwarden
save_secrets

