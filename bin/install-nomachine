#!/usr/bin/env bash

source platform

install_no_machine () {
  if [[ "$PLATFORM" == "mac" ]]; then
    brew install --cask nomachine
  fi
  if [[ "$PLATFORM" == "arch" ]]; then
    cd ~
    git clone https://aur.archlinux.org/nomachine.git
    cd nomachineinstall-nom
    sudo sed -i "s/_autoservice=n/_autoservice=y/g" ~/nomachine/PKGBUILD
    makepkg -sirc
    sudo pacman -Rns $(pacman -Qdtq)	
    sudo sed -i "s/su/system-remote-login/g" /etc/pam.d/nx
    sudo sed -i "s@DefaultDesktopCommand.*@DefaultDesktopCommand \"env DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/$(id -u)/bus ~/bin/start-desktop-arch@g"
    sudo systemctl enable --now nxserver.service
    sudo /etc/NX/nxserver --restart
  fi
}

install_no_machine
